<!DOCTYPE html>
<html lang="en">

<head>
    <title></title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://chux0519.github.io/style.css">
    <link rel="stylesheet" href="https://chux0519.github.io/color/hexyoungs.css">

    <link rel="stylesheet" href="https://chux0519.github.io/font-hack-subset.css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://chux0519.github.io/rss.xml">


        <link rel="shortcut icon" type="image&#x2F;png" href="/favicon.png">
    
    </head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://chux0519.github.io" style="text-decoration: none;">
                    <div class="logo">
                            chux0519
                        </div>
                </a>
            </div>
        </div>

        <nav class="menu">
            <ul class="menu__inner">
                <li><a href="https://chux0519.github.io">main</a></li>
            
                <li class="active"><a href="https://chux0519.github.io/blog">blog</a></li>
            
                <li><a href="https://chux0519.github.io/projects">projects</a></li>
            
                <li><a href="https://github.com/chux0519" target="_blank" rel="noopener noreferrer">github</a></li>
            </ul>
        </nav>
    
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://chux0519.github.io/blog/cs144-lab1/">CS144 Lab1 学习笔记</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2020-08-28
        </span>

    </div>

    

        
        <div class="post-content">
            <p>CS144 是一门关于计算机网络的斯坦福大学的公开课。课程的实验是动手写一个用户态的 TCP 协议，本文是第二篇。</p>
<ul>
<li>
<p>课程链接: https://cs144.github.io/</p>
</li>
<li>
<p>本文讲义: https://cs144.github.io/assignments/lab1.pdf</p>
</li>
<li>
<p>本文相关代码: https://github.com/hexyoungs/tcplab/tree/lab1</p>
</li>
</ul>
<span id="continue-reading"></span><h2 id="bei-jing-zhi-shi">背景知识</h2>
<p>数据在网络中的传播是字节流，字节流会被切分为不同大小的数据包，这些包在网络中传输。在网路中，每个包的传输速度、传输路径等等都是不可控的，因此数据包到达的顺序也是不可控的，所以 TCP 协议需要完成这些数据包的重组工作。</p>
<h2 id="jiang-yi">讲义</h2>
<p>Lab1 算是开篇，介绍了我们实现 TCP 协议的策略，即模块化地实现它，并且划分了接下来几个 Lab 的主要内容和需要实现的模块。</p>
<p>Lab1 的内容是实现一个 Stream 的重组器(reassembler)，接收一堆字节片段，然后将他们重组成为顺序正确，完整的内容。</p>
<h2 id="yao-dian">要点</h2>
<p>首先简单转换一下问题：输入字符串片段和它们所在的位置，输出一个完整有序的字符串。</p>
<p>这是关键的函数签名</p>
<pre data-lang="cpp" style="background-color:#2b303b;color:#c0c5ce;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span style="color:#b48ead;">void </span><span>StreamReassembler::</span><span style="color:#8fa1b3;">push_substring</span><span>(</span><span style="color:#b48ead;">const</span><span> string &amp;</span><span style="color:#bf616a;">data</span><span>, </span><span style="color:#b48ead;">const </span><span>size_t </span><span style="color:#bf616a;">index</span><span>, </span><span style="color:#b48ead;">const bool </span><span style="color:#bf616a;">eof</span><span>)
</span></code></pre>
<p>index 是 data 的第一个字节在原数据的位置，假设所有数据按照正确的顺序到达，并且不存在重传的数据包，那么就什么都不用管，直接往目的地写数据就行了。</p>
<p>为了达到这种假设</p>
<ul>
<li>首先，可以使用最小堆，每来一条数据，就按照 index 插入进堆，如果堆顶部数据的 index 正好是需要的，那就取出来，写到目的地。如果不是，说明想要的数据片段还没有到，还需要再等等。</li>
<li>其次要考虑到边界情况，比如包可能产生重传，也可能出现 overlap 的现象</li>
</ul>
<img class="center" src="https://i.imgur.com/33VT1MT.png" />
<p>整体按照这个大思路，使用测试用例作为辅助，实现即可。</p>
<h2 id="sui-pian-bi-ji">碎片笔记</h2>
<p>实现过程中，下面几点是我个人不太熟悉的部分</p>
<ol>
<li>使用 <code>make_heap</code>，<code>push_heap</code>，<code>pop_heap</code> 操作的目标是一个复杂对象时，可以传入自定义的比较器。</li>
<li>使用 <code>pop_heap</code> 还需要配合容器的 pop 比如配合 vector 的 <code>pop_back</code>。</li>
<li>想要截取子字符串一定要通过 string 的 <code>substr</code> 方法，不要试图直接利用 <code>c_str</code> 的内容加 offset 的方式，这样可能会丢失需要写入的数据（debug 了好一阵子才发现）。</li>
</ol>
<h2 id="jie-yu">结语</h2>
<p>Lab1 需要实现的接口依旧很少，需要考虑的更多是边界情况，有测试用例的情况下还是相对容易的。难度开始递进了，期待下一个 Lab..</p>
<p>另外，完整实现在 repo 的 lab1-ans 分支供同学们参考。</p>

        </div>

        
    </div>

    </div>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright copyright--user">&copy; Copyright 2024 by&nbsp<a href="https://chux0519.github.io">chux0519</a>.</div>
            </div>
    </footer>
    

</div>
</body>

</html>
